---
- hosts: all
  sudo: true
  vars:
    username: admin
    password: admin
    wowza_version: 4.4.0
    dir: "/usr/local/WowzaStreamingEngine"

  roles:
    - web
    - wowza

  tasks:
    - name: Installing other utils
      apt:
        state: present
        update_cache: yes
        cache_valid_time: 86400
        name:
          - emacs-nox

    - name: Symlink NitroXyWowzaModule.jar module
      file:
        path: "{{ dir }}/lib/NitroxyWowzaModule.jar"
        src: "/vagrant/NitroxyWowzaModule.jar"
        state: link
        force: yes

    - name: Enable NitroXyWowzaModule ServerListener
      lineinfile:
        dest: "{{ dir }}/conf/Server.xml"
        line: '\t\t\t<ServerListener><BaseClass>com.nitroxy.wmz.module.ServerListener</BaseClass></ServerListener>'
        insertbefore: '.*</ServerListeners>'

    - name: Enable NitroXyWowzaModule in application
      lineinfile:
        dest: "{{ dir }}/conf/Application.xml"
        line: '\t\t\t<Module><Name>NitroXyModule</Name><Description>NitroXy stream control module</Description><Class>com.nitroxy.wmz.module.NitroXyModule</Class></Module>'
        insertbefore: '.*</Modules>'
